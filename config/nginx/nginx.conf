# nginx configuration for proxying

user                                            REPLACE_WWW_USER;
worker_processes                                auto;
daemon                                          off;
error_log                                       REPLACE_LOG_DIR/nginx.log warn;
pid                                             REPLACE_RUN_DIR/nginx.pid;
events                                          { worker_connections 1024; }

http {
    include                                     REPLACE_ETC_DIR/mime.types;
    default_type                                "text/html";
    sendfile                                    on;
    keepalive_timeout                           65;
    gzip                                        on;
    map                                         $http_upgrade $connection_upgrade { default upgrade; '' close; }
    disable_symlinks                            off;
    root                                        /var/lib/nginx/html;

    server {
      listen                                    0.0.0.0:80;
      server_name                               REPLACE_SERVER_NAME;
      error_log                                 REPLACE_LOG_DIR/error.log info;
      access_log                                REPLACE_LOG_DIR/access.REPLACE_SERVER_NAME.log;
      keepalive_timeout                         75 75;
      client_max_body_size                      0;
      chunked_transfer_encoding                 on;
      add_header Strict-Transport-Security      "max-age=7200";
    
      location / {
        proxy_pass                              http://127.0.0.1:8000;
        proxy_ssl_verify                        off;
        proxy_http_version                      1.1;
        proxy_connect_timeout                   3600;
        proxy_send_timeout                      3600;
        proxy_read_timeout                      3600;
        proxy_intercept_errors                  off;
        proxy_request_buffering                 off;
        proxy_buffering                         off;
        proxy_set_header                        Host               $http_host;
        proxy_set_header                        X-Real-IP          $remote_addr;
        proxy_set_header                        X-Forwarded-For    $proxy_add_x_forwarded_for;
        proxy_set_header                        X-Forwarded-Proto  $scheme;
        proxy_set_header                        Upgrade            $http_upgrade;
        proxy_set_header                        Connection         $connection_upgrade;
        send_timeout                            3600;
        client_max_body_size                    0;
    }
  }
}
